<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NMSHE Climate Geo-Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
body { margin:0; font-family:Arial; background:#eef2f5; }
header { background:#003366; color:#fff; padding:12px; text-align:center; font-size:20px; }
#alertBanner { display:none; padding:10px; text-align:center; font-weight:bold; }
.alert-heat{background:#b71c1c;color:#fff;}
.alert-cold{background:#263238;color:#fff;}
.alert-rain{background:#0d47a1;color:#fff;}
.panel { background:#fff; padding:10px; border-radius:6px; margin:10px auto; max-width:1100px; }
.hidden { display:none; }
#map { height:420px; border-radius:8px; }
table { width:100%; border-collapse:collapse; font-size:13px; }
th, td { border:1px solid #ccc; padding:6px; }
button, select, input { padding:6px; margin:4px; }
</style>
</head>
<body>
<header>üåè NMSHE Climate & Geo-Spatial Monitoring Portal</header>
<div id="alertBanner"></div>
<!-- LOGIN -->
<div id="loginBox" class="panel">
<h3>üîê Login</h3>
<select id="role">
  <option value="viewer">Viewer</option>
  <option value="admin">Admin</option>
</select>
<input type="password" id="pwd" placeholder="Password">
<button onclick="login()">Login</button>
</div>
<!-- DASHBOARD -->
<div id="dashboard" class="hidden">
<div class="panel">
<b>Role:</b> <span id="userRole"></span>
<button onclick="getLocation()">üìç Get Live Data</button>
<button id="exportBtn" onclick="exportLogs()">‚¨á Export Logs</button>
</div>
<div id="map" class="panel"></div>
<div class="panel">
<h4>üìç Location</h4>
<div id="lat">Latitude: --</div>
<div id="lon">Longitude: --</div>
<div id="place">Place: --</div>
</div>
<div class="panel">
<h4>üå¶ Live Climate Data</h4>
<div id="temp">Temperature: --</div>
<div id="humidity">Humidity: --</div>
<div id="weather">Weather: --</div>
</div>
<div class="panel">
<h4>üìã Audit Logs</h4>
<table>
<thead>
<tr><th>User</th><th>Role</th><th>Action</th><th>Time</th></tr>
</thead>
<tbody id="logs"></tbody>
</table>
</div>
</div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* ================= CONFIG ================= */
const API_KEY = "4d7f263908ac1c04574dc6eb9ee095be";
const ADMIN_PWD = "Musaib123";
const VIEWER_PWD = "viewer123";
/* ================= GLOBAL ================= */
let currentRole="", map, marker;
let logs=[];
let baseLayer, rainLayer, terrainLayer, sentinelLayer, pressureLayer, windLayer, cloudsLayer;
/* ================= LOGIN ================= */
function login() {
  const role=document.getElementById("role").value;
  const pwd=document.getElementById("pwd").value;

  if ((role==="admin" && pwd!==ADMIN_PWD) ||
      (role==="viewer" && pwd!==VIEWER_PWD)) {
    alert("Invalid credentials"); return;
  }
  currentRole=role;
  document.getElementById("userRole").innerText=role.toUpperCase();
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("dashboard").classList.remove("hidden");
  if(role==="viewer") document.getElementById("exportBtn").disabled=true;
  initMap();
  logAction("Logged in");
}
/* ================= MAP ================= */
function initMap() {
  map = L.map("map").setView([33.7, 75.3], 7);

  // Base layer
  
